{"version":3,"file":"sifter.js","sources":["../../lib/diacritics.ts","../../lib/utils.ts","../../lib/sifter.ts"],"sourcesContent":["\ntype TDiacraticList = {[key:string]:string};\n\n// https://github.com/andrewrk/node-diacritics/blob/master/index.js\nvar DIACRITICS:TDiacraticList = {\n\t\" \":\" \",\n\t0:\"߀\",\n\tA:\"ⒶＡÀÁÂẦẤẪẨÃĀĂẰẮẴẲȦǠÄǞẢÅǺǍȀȂẠẬẶḀĄȺⱯ\",\n\tAA:\"Ꜳ\",\n\tAE:\"ÆǼǢ\",\n\tAO:\"Ꜵ\",\n\tAU:\"Ꜷ\",\n\tAV:\"ꜸꜺ\",\n\tAY:\"Ꜽ\",\n\tB:\"ⒷＢḂḄḆɃƁ\",\n\tC:\"ⒸＣꜾḈĆCĈĊČÇƇȻ\",\n\tD:\"ⒹＤḊĎḌḐḒḎĐƊƉᴅꝹ\",\n\tDh:\"Ð\",\n\tDZ:\"ǱǄ\",\n\tDz:\"ǲǅ\",\n\tE:\"ɛⒺＥÈÉÊỀẾỄỂẼĒḔḖĔĖËẺĚȄȆẸỆȨḜĘḘḚƐƎᴇ\",\n\tF:\"ꝼⒻＦḞƑꝻ\",\n\tG:\"ⒼＧǴĜḠĞĠǦĢǤƓꞠꝽꝾɢ\",\n\tH:\"ⒽＨĤḢḦȞḤḨḪĦⱧⱵꞍ\",\n\tI:\"ⒾＩÌÍÎĨĪĬİÏḮỈǏȈȊỊĮḬƗ\",\n\tJ:\"ⒿＪĴɈȷ\",\n\tK:\"ⓀＫḰǨḲĶḴƘⱩꝀꝂꝄꞢ\",\n\tL:\"ⓁＬĿĹĽḶḸĻḼḺŁȽⱢⱠꝈꝆꞀ\",\n\tLJ:\"Ǉ\",\n\tLj:\"ǈ\",\n\tM:\"ⓂＭḾṀṂⱮƜϻ\",\n\tN:\"ꞤȠⓃＮǸŃÑṄŇṆŅṊṈƝꞐᴎ\",\n\tNJ:\"Ǌ\",\n\tNj:\"ǋ\",\n\tO:\"ⓄＯÒÓÔỒỐỖỔÕṌȬṎŌṐṒŎȮȰÖȪỎŐǑȌȎƠỜỚỠỞỢỌỘǪǬØǾƆƟꝊꝌ\",\n\tOE:\"Œ\",\n\tOI:\"Ƣ\",\n\tOO:\"Ꝏ\",\n\tOU:\"Ȣ\",\n\tP:\"ⓅＰṔṖƤⱣꝐꝒꝔ\",\n\tQ:\"ⓆＱꝖꝘɊ\",\n\tR:\"ⓇＲŔṘŘȐȒṚṜŖṞɌⱤꝚꞦꞂ\",\n\tS:\"ⓈＳẞŚṤŜṠŠṦṢṨȘŞⱾꞨꞄ\",\n\tT:\"ⓉＴṪŤṬȚŢṰṮŦƬƮȾꞆ\",\n\tTh:\"Þ\",\n\tTZ:\"Ꜩ\",\n\tU:\"ⓊＵÙÚÛŨṸŪṺŬÜǛǗǕǙỦŮŰǓȔȖƯỪỨỮỬỰỤṲŲṶṴɄ\",\n\tV:\"ⓋＶṼṾƲꝞɅ\",\n\tVY:\"Ꝡ\",\n\tW:\"ⓌＷẀẂŴẆẄẈⱲ\",\n\tX:\"ⓍＸẊẌ\",\n\tY:\"ⓎＹỲÝŶỸȲẎŸỶỴƳɎỾ\",\n\tZ:\"ⓏＺŹẐŻŽẒẔƵȤⱿⱫꝢ\",\n\ta:\"ⓐａẚàáâầấẫẩãāăằắẵẳȧǡäǟảåǻǎȁȃạậặḁąⱥɐɑ\",\n\taa:\"ꜳ\",\n\tae:\"æǽǣ\",\n\tao:\"ꜵ\",\n\tau:\"ꜷ\",\n\tav:\"ꜹꜻ\",\n\tay:\"ꜽ\",\n\tb:\"ⓑｂḃḅḇƀƃɓƂ\",\n\tc:\"ｃⓒćĉċčçḉƈȼꜿↄ\",\n\td:\"ⓓｄḋďḍḑḓḏđƌɖɗƋᏧԁꞪ\",\n\tdh:\"ð\",\n\tdz:\"ǳǆ\",\n\te:\"ⓔｅèéêềếễểẽēḕḗĕėëẻěȅȇẹệȩḝęḙḛɇǝ\",\n\tf:\"ⓕｆḟƒ\",\n\tff:\"ﬀ\",\n\tfi:\"ﬁ\",\n\tfl:\"ﬂ\",\n\tffi:\"ﬃ\",\n\tffl:\"ﬄ\",\n\tg:\"ⓖｇǵĝḡğġǧģǥɠꞡꝿᵹ\",\n\th:\"ⓗｈĥḣḧȟḥḩḫẖħⱨⱶɥ\",\n\thv:\"ƕ\",\n\ti:\"ⓘｉìíîĩīĭïḯỉǐȉȋịįḭɨı\",\n\tj:\"ⓙｊĵǰɉ\",\n\tk:\"ⓚｋḱǩḳķḵƙⱪꝁꝃꝅꞣ\",\n\tl:\"ⓛｌŀĺľḷḹļḽḻſłƚɫⱡꝉꞁꝇɭ\",\n\tlj:\"ǉ\",\n\tm:\"ⓜｍḿṁṃɱɯ\",\n\tn:\"ⓝｎǹńñṅňṇņṋṉƞɲŉꞑꞥлԉ\",\n\tnj:\"ǌ\",\n\to:\"ⓞｏòóôồốỗổõṍȭṏōṑṓŏȯȱöȫỏőǒȍȏơờớỡởợọộǫǭøǿꝋꝍɵɔᴑ\",\n\toe:\"œ\",\n\toi:\"ƣ\",\n\too:\"ꝏ\",\n\tou:\"ȣ\",\n\tp:\"ⓟｐṕṗƥᵽꝑꝓꝕρ\",\n\tq:\"ⓠｑɋꝗꝙ\",\n\tr:\"ⓡｒŕṙřȑȓṛṝŗṟɍɽꝛꞧꞃ\",\n\ts:\"ⓢｓśṥŝṡšṧṣṩșşȿꞩꞅẛʂ\",\n\tss:\"ß\",\n\tt:\"ⓣｔṫẗťṭțţṱṯŧƭʈⱦꞇ\",\n\tth:\"þ\",\n\ttz:\"ꜩ\",\n\tu:\"ⓤｕùúûũṹūṻŭüǜǘǖǚủůűǔȕȗưừứữửựụṳųṷṵʉ\",\n\tv:\"ⓥｖṽṿʋꝟʌ\",\n\tvy:\"ꝡ\",\n\tw:\"ⓦｗẁẃŵẇẅẘẉⱳ\",\n\tx:\"ⓧｘẋẍ\",\n\ty:\"ⓨｙỳýŷỹȳẏÿỷẙỵƴɏỿ\",\n\tz:\"ⓩｚźẑżžẓẕƶȥɀⱬꝣ\"\n}\n\n/**\n * code points generated from toCodePoints();\n * removed 65339 to 65345\n */\nvar code_points = [\n\t[ 67, 67 ],\n\t[ 160, 160 ],\n\t[ 192, 438 ],\n\t[ 452, 652 ],\n\t[ 961, 961 ],\n\t[ 1019, 1019 ],\n\t[ 1083, 1083 ],\n\t[ 1281, 1289 ],\n\t[ 1984, 1984 ],\n\t[ 5095, 5095 ],\n\t[ 7429, 7441 ],\n\t[ 7545, 7549 ],\n\t[ 7680, 7935 ],\n\t[ 8580, 8580 ],\n\t[ 9398, 9449 ],\n\t[ 11360, 11391 ],\n\t[ 42792, 42793 ],\n\t[ 42802, 42851 ],\n\t[ 42873, 42897 ],\n\t[ 42912, 42922 ],\n\t[ 64256, 64260 ],\n\t[ 65313, 65338 ],\n\t[ 65345, 65370 ]\n];\n\n/**\n * Remove accents\n * via https://github.com/krisk/Fuse/issues/133#issuecomment-318692703\n *\n */\nexport function asciifold(str:string):string{\n\treturn str.normalize('NFD').replace(/[\\u0300-\\u036F]/g, '').normalize('NFKD').toLowerCase();\n};\n\n\n/**\n * Convert list of diacritics to array of code points\n *\n */\n// @ts-ignore\nfunction toCodePoints(tolerance=8){\n\tvar char_codes = [];\n\n\tfor( let letter in DIACRITICS ){\n\t\tlet _diacritics = DIACRITICS[letter];\n\t\tfor( let n = 0; n < _diacritics.length; n++ ){\n\t\t\tvar code_point = _diacritics.codePointAt(n);\n\t\t\tchar_codes.push( code_point );\n\t\t}\n\t}\n\n\t//https://stackoverflow.com/questions/40431572/is-there-a-simple-way-to-group-js-array-values-by-range\n\tchar_codes.sort((a, b) => a - b);\n    var result = char_codes.reduce(function (accumulator, currentValue, index, source) {\n\n\t\tif( !index ){\n\t\t\taccumulator.push( [currentValue,currentValue] );\n\n\t\t}else if( currentValue - source[index - 1] > tolerance ){\n\t\t\taccumulator.push( [currentValue,currentValue] );\n\n\t\t}else{\n\n\t\t\taccumulator.push( [accumulator.pop()[0],currentValue]);\n\t\t}\n\n        return accumulator;\n    }, []);\n\n\tconsole.log(`char_codes (${result.length})`,result);\n}\n\n/**\n * Generate a list of diacritics from the list of code points\n *\n */\nexport function generateDiacritics():TDiacraticList{\n\n\tvar latin_convert = {\n\t\t'l·': 'l',\n\t\t'ʼn': 'n',\n\t\t'æ': 'ae',\n\t\t'ø': 'o',\n\t\t'aʾ': 'a',\n\t\t'dž': 'dz',\n\t};\n\n\tvar diacritics\t= {};\n\t//var no_latin\t= [];\n\tcode_points.forEach((code_range)=>{\n\n\t\tfor(let i = code_range[0]; i <= code_range[1]; i++){\n\t\t\tlet diacritic\t= String.fromCharCode(i);\n\t\t\tlet latin\t\t= diacritic.normalize('NFD').replace(/[\\u0300-\\u036F]/g, '').normalize('NFKD');\n\n\t\t\tif( latin == diacritic ){\n\t\t\t\t//no_latin.push(diacritic);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlatin = latin.toLowerCase();\n\n\t\t\tif( latin in latin_convert ){\n\t\t\t\tlatin = latin_convert[latin];\n\t\t\t}\n\n\t\t\tif( !(latin in diacritics) ){\n\t\t\t\tdiacritics[latin] = latin + latin.toUpperCase();\n\t\t\t}\n\t\t\tdiacritics[latin] += diacritic;\n\t\t}\n\t});\n\n\t//console.log('no_latin',JSON.stringify(no_latin));\n\n\treturn diacritics;\n}\n\n/**\n * Expand a regular expression pattern to include diacritics\n * \teg /a/ becomes /aⓐａẚàáâầấẫẩãāăằắẵẳȧǡäǟảåǻǎȁȃạậặḁąⱥɐɑAⒶＡÀÁÂẦẤẪẨÃĀĂẰẮẴẲȦǠÄǞẢÅǺǍȀȂẠẬẶḀĄȺⱯ/\n *\n */\nvar diacritics:TDiacraticList = null\nexport function diacriticRegexPoints(regex:string):string{\n\n\tif( diacritics === null ){\n\t\tdiacritics = generateDiacritics();\n\t}\n\n\tfor( let latin in diacritics ){\n\t\tif( diacritics.hasOwnProperty(latin) ){\n\t\t\tregex = regex.replace( new RegExp(latin,'g'), '['+diacritics[latin]+']');\n\t\t}\n\t}\n\treturn regex;\n}\n\n\n/**\n * Expand a regular expression pattern to include diacritics\n * \teg /a/ becomes /aⓐａẚàáâầấẫẩãāăằắẵẳȧǡäǟảåǻǎȁȃạậặḁąⱥɐɑAⒶＡÀÁÂẦẤẪẨÃĀĂẰẮẴẲȦǠÄǞẢÅǺǍȀȂẠẬẶḀĄȺⱯ/\n *\n * rollup will bundle this function (and the DIACRITICS constant) unless commented out\n *\nvar diacriticRegex = (function() {\n\n\tvar list = [];\n\tfor( let letter in DIACRITICS ){\n\n\t\tif( letter.toLowerCase() != letter && letter.toLowerCase() in DIACRITICS ){\n\t\t\tcontinue;\n\t\t}\n\n\t\tif( DIACRITICS.hasOwnProperty(letter) ){\n\n\t\t\tvar replace = letter + DIACRITICS[letter];\n\t\t\tif( letter.toUpperCase() in DIACRITICS ){\n\t\t\t\treplace += letter.toUpperCase() + DIACRITICS[letter.toUpperCase()];\n\t\t\t}\n\n\t\t\tlist.push({let:letter,pat:'['+replace+']'});\n\t\t}\n\t}\n\n\treturn function(regex:string):string{\n\t\tlist.forEach((item)=>{\n\t\t\tregex = regex.replace( new RegExp(item.let,'g'),item.pat);\n\t\t});\n\t\treturn regex;\n\t}\n})();\n*/\n","\n// @ts-ignore\nimport { asciifold } from './diacritics.ts';\n\n/**\n * A property getter resolving dot-notation\n * @param  {Object}  obj     The root object to fetch property on\n * @param  {String}  name    The optionally dotted property name to fetch\n * @return {Object}          The resolved property value\n */\nexport function getAttr(obj:{[key:string]:any}, name:string ) {\n    if (!obj ) return;\n    return obj[name];\n};\n\n/**\n * A property getter resolving dot-notation\n * @param  {Object}  obj     The root object to fetch property on\n * @param  {String}  name    The optionally dotted property name to fetch\n * @return {Object}          The resolved property value\n */\nexport function getAttrNesting(obj:{[key:string]:any}, name:string ) {\n    if (!obj ) return;\n    var names = name.split(\".\");\n    while(names.length && (obj = obj[names.shift()]));\n    return obj;\n};\n\n/**\n * Calculates how close of a match the\n * given value is against a search token.\n *\n * @param {object} token\n * @return {number}\n */\nexport function scoreValue(value:string, token, weight:number ) {\n\tvar score, pos;\n\n\tif (!value) return 0;\n\n\tvalue = String(value || '');\n\tpos = value.search(token.regex);\n\tif (pos === -1) return 0;\n\n\tscore = token.string.length / value.length;\n\tif (pos === 0) score += 0.5;\n\n\treturn score * weight;\n};\n\nexport function escape_regex(str) {\n\treturn (str + '').replace(/([.?*+^$[\\]\\\\(){}|-])/g, '\\\\$1');\n};\n\n\n/**\n * Cast object property to an array if it exists and has a value\n *\n */\nexport function propToArray(obj, key){\n\tvar value = obj[key];\n\tif( value && !Array.isArray(value) ){\n\t\tobj[key] = [value];\n\t}\n}\n\n\n/**\n * Iterates over arrays and hashes.\n *\n * ```\n * iterate(this.items, function(item, id) {\n *    // invoked for each item\n * });\n * ```\n *\n * @param {array|object} object\n */\nexport function iterate(object, callback) {\n\n\tif ( Array.isArray(object)) {\n\t\tobject.forEach(callback);\n\n\t}else{\n\n\t\tfor (var key in object) {\n\t\t\tif (object.hasOwnProperty(key)) {\n\t\t\t\tcallback(object[key], key);\n\t\t\t}\n\t\t}\n\t}\n};\n\n\n\nexport function cmp(a, b) {\n\tif (typeof a === 'number' && typeof b === 'number') {\n\t\treturn a > b ? 1 : (a < b ? -1 : 0);\n\t}\n\ta = asciifold(String(a || '')).toLowerCase();\n\tb = asciifold(String(b || '')).toLowerCase();\n\tif (a > b) return 1;\n\tif (b > a) return -1;\n\treturn 0;\n};\n","/**\n * sifter.js\n * Copyright (c) 2013–2020 Brian Reavis & contributors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this\n * file except in compliance with the License. You may obtain a copy of the License at:\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF\n * ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n *\n * @author Brian Reavis <brian@thirdroute.com>\n */\n\n// @ts-ignore\nimport { scoreValue, getAttr, getAttrNesting, escape_regex, propToArray, iterate, cmp } from './utils.ts';\n// @ts-ignore\nimport { diacriticRegexPoints, asciifold } from './diacritics.ts';\n\n\ntype TField = {\n\tfield: string,\n\tweight?: number,\n}\n\ntype TOptions = {\n \tfields: TField[],\n \tsort: any[],\n \tscore?: ()=>any,\n \tfilter?: boolean,\n \tlimit?: number,\n \tsort_empty?: any,\n \tnesting?: boolean,\n\trespect_word_boundaries?: boolean,\n\tconjunction?: string,\n}\n\ntype TToken = {\n\tstring:string,\n\tregex:RegExp,\n\tfield:string\n}\n\ntype TWeights = {[key:string]:number}\n\ntype TPrepareObj = {\n\toptions: TOptions,\n\tquery: string,\n\ttokens: TToken[],\n\ttotal: number,\n\titems: any[],\n\tweights: TWeights,\n\tgetAttrFn: (any,string)=>any,\n\n}\n\n\nexport default class Sifter{\n\n\tpublic items: []|{};\n\tpublic settings: {diacritics:boolean};\n\n\t/**\n\t * Textually searches arrays and hashes of objects\n\t * by property (or multiple properties). Designed\n\t * specifically for autocomplete.\n\t *\n\t * @constructor\n\t * @param {array|object} items\n\t * @param {object} items\n\t */\n\tconstructor(items, settings) {\n\t\tthis.items = items;\n\t\tthis.settings = settings || {diacritics: true};\n\t};\n\n\t/**\n\t * Splits a search string into an array of individual\n\t * regexps to be used to match results.\n\t *\n\t */\n\ttokenize(query:string, respect_word_boundaries?:boolean, weights?:TWeights ):TToken[] {\n\t\tif (!query || !query.length) return [];\n\n\t\tvar tokens = [];\n\t\tvar words = query.split(/\\s+/);\n\t\tvar field_regex;\n\n\t\tif( weights ){\n\t\t\tfield_regex = new RegExp( '^('+ Object.keys(weights).map(escape_regex).join('|')+')\\:(.*)$');\n\t\t}\n\n\t\twords.forEach((word:string) => {\n\t\t\tlet field_match;\n\t\t\tlet field\t= null;\n\t\t\tlet regex\t= null;\n\n\t\t\t// look for \"field:query\" tokens\n\t\t\tif( field_regex && (field_match = word.match(field_regex)) ){\n\t\t\t\tfield\t= field_match[1];\n\t\t\t\tword\t= field_match[2];\n\t\t\t}\n\n\t\t\tif( word.length > 0 ){\n\t\t\t\tregex = escape_regex(word);\n\t\t\t\tif( this.settings.diacritics ){\n\t\t\t\t\tregex = diacriticRegexPoints(regex);\n\t\t\t\t}\n\t\t\t\tif( respect_word_boundaries ) regex = \"\\\\b\"+regex\n\t\t\t\tregex = new RegExp(regex, 'i');\n\t\t\t}\n\n\t\t\ttokens.push({\n\t\t\t\tstring : word,\n\t\t\t\tregex  : regex,\n\t\t\t\tfield  : field,\n\t\t\t});\n\t\t});\n\n\t\treturn tokens;\n\t};\n\n\n\t/**\n\t * Returns a function to be used to score individual results.\n\t *\n\t * Good matches will have a higher score than poor matches.\n\t * If an item is not a match, 0 will be returned by the function.\n\t *\n\t * @returns {function}\n\t */\n\tgetScoreFunction(query:string, options ){\n\t\tvar search = this.prepareSearch(query, options);\n\t\treturn this._getScoreFunction(search);\n\t}\n\n\t_getScoreFunction(search:TPrepareObj ){\n\t\tconst tokens\t\t= search.tokens,\n\t\ttoken_count\t\t\t= tokens.length;\n\n\t\tif (!token_count) {\n\t\t\treturn function() { return 0; };\n\t\t}\n\n\t\tconst fields\t= search.options.fields,\n\t\tweights\t\t\t= search.weights,\n\t\tfield_count\t\t= fields.length,\n\t\tgetAttrFn\t\t= search.getAttrFn;\n\n\n\n\t\t/**\n\t\t * Calculates the score of an object\n\t\t * against the search query.\n\t\t *\n\t\t * @param {TToken} token\n\t\t * @param {object} data\n\t\t * @return {number}\n\t\t */\n\t\tvar scoreObject = (function() {\n\n\t\t\tif (!field_count) {\n\t\t\t\treturn function() { return 0; };\n\t\t\t}\n\n\t\t\tif (field_count === 1) {\n\t\t\t\treturn function(token:TToken, data) {\n\t\t\t\t\tconst field = fields[0].field;\n\t\t\t\t\treturn scoreValue(getAttrFn(data, field), token, weights[field]);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn function(token:TToken, data) {\n\t\t\t\tvar sum = 0;\n\n\t\t\t\t// is the token specific to a field?\n\t\t\t\tif( token.field ){\n\n\t\t\t\t\tconst value = getAttrFn(data, token.field);\n\n\t\t\t\t\tif( !token.regex && value ){\n\t\t\t\t\t\tsum += 0.1;\n\t\t\t\t\t}else{\n\t\t\t\t\t\tsum += scoreValue(value, token, weights[token.field]);\n\t\t\t\t\t}\n\n\n\n\t\t\t\t}else{\n\t\t\t\t\titerate(weights, (weight, field) => {\n\t\t\t\t\t\tsum += scoreValue(getAttrFn(data, field), token, weight);\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn sum / field_count;\n\t\t\t};\n\t\t})();\n\n\t\tif (token_count === 1) {\n\t\t\treturn function(data) {\n\t\t\t\treturn scoreObject(tokens[0], data);\n\t\t\t};\n\t\t}\n\n\t\tif (search.options.conjunction === 'and') {\n\t\t\treturn function(data) {\n\t\t\t\tvar i = 0, score, sum = 0;\n\t\t\t\tfor (; i < token_count; i++) {\n\t\t\t\t\tscore = scoreObject(tokens[i], data);\n\t\t\t\t\tif (score <= 0) return 0;\n\t\t\t\t\tsum += score;\n\t\t\t\t}\n\t\t\t\treturn sum / token_count;\n\t\t\t};\n\t\t} else {\n\t\t\treturn function(data) {\n\t\t\t\tvar sum = 0;\n\t\t\t\titerate(tokens,(token:TToken)=>{\n\t\t\t\t\tsum += scoreObject(token, data);\n\t\t\t\t});\n\t\t\t\treturn sum / token_count;\n\t\t\t};\n\t\t}\n\t};\n\n\t/**\n\t * Returns a function that can be used to compare two\n\t * results, for sorting purposes. If no sorting should\n\t * be performed, `null` will be returned.\n\t *\n\t * @return function(a,b)\n\t */\n\tgetSortFunction(query:string, options) {\n\t\tvar search  = this.prepareSearch(query, options);\n\t\treturn this._getSortFunction(search);\n\t}\n\n\t_getSortFunction(search:TPrepareObj){\n\t\tvar i, n, self, sort_fld, sort_flds, sort_flds_count, multiplier, multipliers, get_field, implicit_score, sort, options;\n\n\t\tself\t\t= this;\n\t\toptions\t\t= search.options;\n\t\tsort\t\t= (!search.query && options.sort_empty) || options.sort;\n\n\t\t/**\n\t\t * Fetches the specified sort field value\n\t\t * from a search result item.\n\t\t *\n\t\t * @param  {string} name\n\t\t * @param  {object} result\n\t\t * @return {string}\n\t\t */\n\t\tget_field = function(name, result) {\n\t\t\tif (name === '$score') return result.score;\n\t\t\treturn search.getAttrFn(self.items[result.id], name);\n\t\t};\n\n\t\t// parse options\n\t\tsort_flds = [];\n\t\tif (sort) {\n\t\t\tfor (i = 0, n = sort.length; i < n; i++) {\n\t\t\t\tif (search.query || sort[i].field !== '$score') {\n\t\t\t\t\tsort_flds.push(sort[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// the \"$score\" field is implied to be the primary\n\t\t// sort field, unless it's manually specified\n\t\tif (search.query) {\n\t\t\timplicit_score = true;\n\t\t\tfor (i = 0, n = sort_flds.length; i < n; i++) {\n\t\t\t\tif (sort_flds[i].field === '$score') {\n\t\t\t\t\timplicit_score = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (implicit_score) {\n\t\t\t\tsort_flds.unshift({field: '$score', direction: 'desc'});\n\t\t\t}\n\t\t} else {\n\t\t\tfor (i = 0, n = sort_flds.length; i < n; i++) {\n\t\t\t\tif (sort_flds[i].field === '$score') {\n\t\t\t\t\tsort_flds.splice(i, 1);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tmultipliers = [];\n\t\tfor (i = 0, n = sort_flds.length; i < n; i++) {\n\t\t\tmultipliers.push(sort_flds[i].direction === 'desc' ? -1 : 1);\n\t\t}\n\n\t\t// build function\n\t\tsort_flds_count = sort_flds.length;\n\t\tif (!sort_flds_count) {\n\t\t\treturn null;\n\t\t} else if (sort_flds_count === 1) {\n\t\t\tsort_fld = sort_flds[0].field;\n\t\t\tmultiplier = multipliers[0];\n\t\t\treturn function(a, b) {\n\t\t\t\treturn multiplier * cmp(\n\t\t\t\t\tget_field(sort_fld, a),\n\t\t\t\t\tget_field(sort_fld, b)\n\t\t\t\t);\n\t\t\t};\n\t\t} else {\n\t\t\treturn function(a, b) {\n\t\t\t\tvar i, result, field;\n\t\t\t\tfor (i = 0; i < sort_flds_count; i++) {\n\t\t\t\t\tfield = sort_flds[i].field;\n\t\t\t\t\tresult = multipliers[i] * cmp(\n\t\t\t\t\t\tget_field(field, a),\n\t\t\t\t\t\tget_field(field, b)\n\t\t\t\t\t);\n\t\t\t\t\tif (result) return result;\n\t\t\t\t}\n\t\t\t\treturn 0;\n\t\t\t};\n\t\t}\n\t};\n\n\t/**\n\t * Parses a search query and returns an object\n\t * with tokens and fields ready to be populated\n\t * with results.\n\t *\n\t */\n\tprepareSearch(query:string, optsUser):TPrepareObj {\n\t\tconst weights\t= {};\n\t\tvar options\t\t= Object.assign({},optsUser);\n\n\t\tpropToArray(options,'sort');\n\t\tpropToArray(options,'sort_empty');\n\n\t\t// convert fields to new format\n\t\tif( options.fields ){\n\t\t\tpropToArray(options,'fields');\n\t\t\tif( Array.isArray(options.fields) && typeof options.fields[0] !== 'object' ){\n\t\t\t\tvar fields = [];\n\t\t\t\toptions.fields.forEach((fld_name) => {\n\t\t\t\t\tfields.push({field:fld_name});\n\t\t\t\t});\n\t\t\t\toptions.fields = fields;\n\t\t\t}\n\n\n\t\t\toptions.fields.forEach((field_params)=>{\n\t\t\t\tweights[field_params.field] = ('weight' in field_params) ? field_params.weight : 1;\n\t\t\t});\n\t\t}\n\n\t\tquery = asciifold( String(query || '') ).toLowerCase().trim();\n\n\t\treturn {\n\t\t\toptions\t\t: options,\n\t\t\tquery\t\t: query,\n\t\t\ttokens\t\t: this.tokenize(query, options.respect_word_boundaries, weights),\n\t\t\ttotal\t\t: 0,\n\t\t\titems\t\t: [],\n\t\t\tweights\t\t: weights,\n\t\t\tgetAttrFn\t: (options.nesting) ? getAttrNesting : getAttr,\n\t\t};\n\t};\n\n\t/**\n\t * Searches through all items and returns a sorted array of matches.\n\t *\n\t */\n\tsearch(query:string, options:TOptions) : TPrepareObj {\n\t\tvar self = this, score, search;\n\t\tvar fn_sort;\n\t\tvar fn_score;\n\n\t\tsearch  = this.prepareSearch(query, options);\n\t\toptions = search.options;\n\t\tquery   = search.query;\n\n\t\t// generate result scoring function\n\t\tfn_score = options.score || self._getScoreFunction(search);\n\n\t\t// perform search and sort\n\t\tif (query.length) {\n\t\t\titerate(self.items, (item, id) => {\n\t\t\t\tscore = fn_score(item);\n\t\t\t\tif (options.filter === false || score > 0) {\n\t\t\t\t\tsearch.items.push({'score': score, 'id': id});\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\titerate(self.items, (item, id) => {\n\t\t\t\tsearch.items.push({'score': 1, 'id': id});\n\t\t\t});\n\t\t}\n\n\t\tfn_sort = self._getSortFunction(search);\n\t\tif (fn_sort) search.items.sort(fn_sort);\n\n\t\t// apply limits\n\t\tsearch.total = search.items.length;\n\t\tif (typeof options.limit === 'number') {\n\t\t\tsearch.items = search.items.slice(0, options.limit);\n\t\t}\n\n\t\treturn search;\n\t};\n}\n"],"names":["code_points","asciifold","str","normalize","replace","toLowerCase","generateDiacritics","latin_convert","diacritics","forEach","code_range","i","diacritic","String","fromCharCode","latin","toUpperCase","diacriticRegexPoints","regex","hasOwnProperty","RegExp","getAttr","obj","name","getAttrNesting","names","split","length","shift","scoreValue","value","token","weight","score","pos","search","string","escape_regex","propToArray","key","Array","isArray","iterate","object","callback","cmp","a","b","Sifter","constructor","items","settings","tokenize","query","respect_word_boundaries","weights","tokens","words","field_regex","Object","keys","map","join","word","field_match","field","match","push","getScoreFunction","options","prepareSearch","_getScoreFunction","token_count","fields","field_count","getAttrFn","scoreObject","data","sum","conjunction","getSortFunction","_getSortFunction","n","self","sort_fld","sort_flds","sort_flds_count","multiplier","multipliers","get_field","implicit_score","sort","sort_empty","result","id","unshift","direction","splice","optsUser","assign","fld_name","field_params","trim","total","nesting","fn_sort","fn_score","item","filter","limit","slice"],"mappings":"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"}